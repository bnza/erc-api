#!/bin/sh
# Pre-commit hook to run PHP-CS-Fixer on staged PHP files

# Environment variables - use default if not already set
if [ -z "$PHP_CS_FIXER" ]; then
    PHP_CS_FIXER="./api/vendor/bin/php-cs-fixer"
fi

# Local variables
staged_files=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(php)$')

# Exit early if no PHP files are staged
if [ -z "$staged_files" ]; then
    exit 0
fi

echo "Running PHP-CS-Fixer on staged PHP files..."

# Check if PHP-CS-Fixer exists
if [ ! -f "$PHP_CS_FIXER" ]; then
    echo "Error: PHP-CS-Fixer not found at $PHP_CS_FIXER. Please install it first."
    exit 1
fi

# Process each staged file
for file in $staged_files; do
    "$PHP_CS_FIXER" fix "$file" --config=./api/php-cs-fixer.dist.php
    git add "$file"
done

echo "PHP-CS-Fixer completed successfully."
